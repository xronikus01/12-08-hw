# 12.8. Резервное копирование баз данных — Гаран Степан


---

---

## Задание 1. Резервное копирование

### 1.1. Восстановление данных в полном объёме за предыдущий день
Подходит **полное резервное копирование (Full backup)** один раз в сутки (например, ночью).
Тогда для восстановления “за предыдущий день” достаточно взять последний полный бэкап и развернуть его.

Чтобы уменьшить объём хранения, часто используют схему:
- периодический **полный бэкап** (например, раз в неделю),
- между ними — **дифференциальные** или **инкрементные** бэкапы.

Но если требование — именно “полный объём за предыдущий день” и важна простота восстановления, то ежедневный full backup — самый прямой вариант.


### 1.2. Восстановление данных за час до предполагаемой поломки
Подходит восстановление **на момент времени (Point-in-Time Recovery, PITR)**:
- делаем **полный бэкап** (например, раз в сутки),
- дополнительно сохраняем **журналы изменений** (WAL для PostgreSQL / binlog для MySQL),
- при аварии восстанавливаем full backup и “докатываем” журналы до нужного времени (например, до T-1 час).

Так можно получить состояние базы “за час до поломки” с точностью до минут/секунд (в зависимости от частоты и режима логирования).


### 1.3.* Мгновенное переключение на работающую/починенную БД
Да, такой кейс возможен — это называется **failover** (аварийное переключение).

Пример: есть основная БД (master/primary) и реплика (standby/replica), которая постоянно получает изменения.
При падении основной БД система (или администратор) делает **переключение**:
- реплика становится новой основной БД (promote),
- приложение/прокси перенаправляет подключения на новый primary.

Для “почти мгновенного” переключения обычно используют:
- репликацию (например, primary → standby),
- менеджер/оркестратор (Patroni/Keepalived/Orchestrator, Kubernetes и т.п.),
- виртуальный IP / DNS / балансировщик, чтобы приложению не менять адрес.

Важно: полностью “без потерь” зависит от режима репликации:
- при **синхронной** репликации потери данных минимальны/нулевые, но ниже производительность;
- при **асинхронной** переключение быстрее и проще, но возможна потеря последних транзакций.


---

## Задание 2. PostgreSQL

### 2.1. Пример команды резервирования и восстановления (pg_dump/pg_restore)

**Резервная копия (dump) одной базы в формате custom:**
```bash
pg_dump -U postgres -h localhost -p 5432 -F c -f backup.dump mydb

### 2.1.* Автоматизация процесса
...

---

## Задание 3. MySQL

### 3.1. Пример команды инкрементного резервного копирования
...

### 3.1.* Когда реплика выгоднее обычного бэкапа?
...

---
